function name_to_path(a,e){for(var n in e)e[n]=a+e[n];return e}function flipCoin(){return pickRandom([!0,!1])}function randomizeArr(a){return a.sort(function(){return.5-Math.random()})}function pickRandom(a){return a[Math.floor(Math.random()*a.length)]}function getRandom1to10(){return pickRandom([1,2,3,4,5,6,7,8])}function createClip(a){var e={clip:null,play:function(){e.clip||e.create(),e.clip.loop=!1,e.clip.start()},pause:function(){e.clip&&(e.clip.stop(),e.clip.output.disconnect())},create:function(){var n={pattern:function(){return a.offset?"----".repeat(a.offset)+a.pattern:a.pattern}()};a.notes&&(n.notes=a.notes),a.synth&&(n.synth=a.synth),a.sample&&(n.sample=a.sample),a.samples&&(n.samples=a.samples),e.clip=scribble.clip(n),a.volume&&(e.clip.output.volume.input.value=a.volume)}};return e}function createIntro(a){return a.edm&&flipCoin()?(a.hasPiano=!0,[{pattern:getRandomPattern(0,"agg"),sample:getRandomPiano(),volume:.25},{pattern:getRandomPattern(0,"agg"),sample:getRandomPiano(),volume:.25}]):a.edm?(a.hasEdmSound=!0,[{pattern:getRandomPattern(),sample:getRandomEdmSound(0,"sim"),volume:.25},{pattern:getRandomPattern(),sample:getRandomEdmSound(0,"sim"),volume:.25}]):a.trap&&flipCoin()?(a.hasSnare=!0,a.hasHat=!0,[{pattern:getRandomPattern(),sample:getRandomSnare()},{pattern:getRandomPattern(),sample:getRandomHat()}]):(a.hasSnare=!0,a.hasEdmSound=!0,[{pattern:getRandomPattern(),sample:getRandomSnare()},{pattern:getRandomPattern(),sample:getRandomEdmSound(0,"sim"),volume:.25}])}function createChorus(a,e){return a=a.concat([{pattern:getRandomPattern(),sample:getRandomKick()},{pattern:getRandomPattern(),sample:getRandomBass()}]),e.edm?(flipCoin()&&a.push({pattern:getRandomPattern(0,"agg"),sample:getRandomTranceLead(),volume:.5}),a):e.trap?(flipCoin()&&!e.hasEdmSound&&a.push({pattern:getRandomPattern(),samples:guitar,notes:randomizeArr(guitar_notes).pop()}),flipCoin()&&!e.hasEdmSound&&a.push({pattern:getRandomPattern(),samples:piano,notes:randomizeArr(piano_notes).join(" "),volume:.25}),a):void 0}function createVerse(a,e){return a.concat([{pattern:getRandomPattern(),sample:getRandomBass()}])}function createOutro(a){return[{pattern:getRandomPattern(),sample:getRandomSnare()},{pattern:getRandomPattern(),sample:getRandomSnare()}]}function addOverlay(a,e){return flipCoin()&&a.push({pattern:getRandomPattern(0,"sim"),sample:getRandomEdmSound(),volume:.25}),flipCoin()&&!e.hasSnare&&(e.hasSnare=!0,a.push({pattern:getRandomPattern(),sample:getRandomSnare()})),flipCoin()&&!e.hasHat&&(e.hasHat=!0,a.push({pattern:getRandomPattern(),sample:getRandomHat()})),a}function downloadBlob(a){var e=document.getElementById("rec"),n=document.createElement("a");document.body.appendChild(n),n.style="display: none",n.href=e.src,n.download="audio.webm",n.click()}function getRandomPattern(a,e){if("sim"==e)return pickRandom(["-x--","x","---x","x---"]);var n,t=null;"agg"==e?(n=["x-","xx","x[xx]"],t=2):(n=pickRandom([["-","x","x","x","[xx]","[x-]","[-x]"],["x-","-x"]]),t=4);for(var o="",v=0;t>v;v++)o+=n[Math.floor(Math.random()*n.length)];return o}function getRandomTranceLead(){return pickRandom(inst.transLeads)}function getRandomGuitar(){return pickRandom(happy.guitars)}function getRandomSnare(){return pickRandom(inst.snares)}function getRandomHat(){return pickRandom(inst.hats)}function getRandomBass(){return pickRandom(inst.basses)}function getRandomPsyTransBass(){return pickRandom(inst.psyBasses)}function getRandomEdmSound(){return pickRandom(happy.edmSounds)}function getRandomKick(){return pickRandom(inst.kicks)}function getRandomPiano(){return pickRandom(happy.pianos)}function getRandomciriusRez(){return pickRandom(inst.ciriusRezs)}function getRandomCelestialPad(){return pickRandom(happy.celestialPs)}function getRandomKorgBass(){return pickRandom(inst.korgBasses)}function mergePatterns(a,e,n){var t=[];for(var o in a){var v=e,w={pattern:a[o].pattern.repeat(v),offset:n};a[o].sample&&(w.sample=a[o].sample),a[o].samples&&(w.samples=a[o].samples),a[o].notes&&(w.notes=a[o].notes),a[o].volume&&(w.volume=a[o].volume),t.push(createClip(w))}return t}function playAndRecordSong(a){var e=Tone.context,n=e.createMediaStreamDestination(),t=new MediaRecorder(n.stream),o=document.getElementById("rec"),v=document.getElementById("download");v.setAttribute("disabled","disabled");var w=[];t.ondataavailable=function(a){w.push(a.data)},t.onstop=function(){var a=new Blob(w,{type:"audio/webm; codecs=opus"});o.src=URL.createObjectURL(a),v.removeAttribute("disabled")};var r=null;for(var i in a)if(a[i])for(var s in a[i])a[i][s]&&(a[i][s].play(),a[i][s].clip.output.connect(n),r=a[i][s].clip);t.start(1e3);var p=null;r.callback=function(a){clearTimeout(p),p=setTimeout(function(){t.stop(),Tone.Transport.stop()},1e3)}}function stopPlaybackAndRecording(a){for(var e in a)if(a[e])for(var n in a[e])a[e][n]&&a[e][n].pause();Tone.Transport.stop()}function createSong(a){var e={intro:[],chorus1:[],verse1:[],chorus2:[],verse2:[],chorus3:[],outro:[]};e[a]=!0;var n=0,t=createIntro(e),o=createChorus(t,e),v=createVerse(t,e),w=createOutro(e);return t.length>0?e.intro=mergePatterns(t,4,n):delete e.intro,t.length>0&&(n+=4),e.chorus1=mergePatterns(o,8,n),n+=8,e.verse1=mergePatterns(v,8,n),n+=8,e.chorus2=mergePatterns(addOverlay(Array.from(o),e),8,n),n+=8,e.verse2=mergePatterns(addOverlay(Array.from(v),e),8,n),n+=8,e.chorus3=mergePatterns(addOverlay(Array.from(o),e),8,n),n+=8,e.outro=mergePatterns(w,4,n),e}var inst={basses:name_to_path("/audio/basses/",["bass.wav"]),edmSounds:name_to_path("/audio/edm/",["wave.wav","tick.wav","ping.wav","pinch.wav","echo.wav","drum.wav","drop.wav"]),guitars:name_to_path("/audio/guitars/",["mellow-1.wav","mellow-2.wav","mellow-3.wav"]),hats:name_to_path("/audio/hats/",["ch.wav","oh.wav"]),kicks:name_to_path("/audio/kicks/",["kick.wav"]),pianos:name_to_path("/audio/piano/",["piano58.wav","piano69.wav","piano79.wav"]),snares:name_to_path("/audio/snares/",["snare.wav"]),celestialPs:name_to_path("/audio/celestialPad/",["a3.wav","a4.wav","ab3.wav","ab4.wav","b3.wav","b4.wav","bb3.wav","bb4.wav","c3.wav","c4.wav","c5.wav","d3.wav","d4.wav","db3.wav","db4.wav","e3.wav","e4.wav","eb3.wav","eb4.wav","f3.wav","f4.wav","g3.wav","g4.wav","gb3.wav","gb4.wav"]),ciriusRezs:name_to_path("/audio/ciriusRez/",["a3.wav","a4.wav","ab3.wav","ab4.wav","b3.wav","b4.wav","bb3.wav","bb4.wav","c3.wav","c4.wav","d3.wav","d4.wav","db3.wav","db4.wav","e3.wav","e4.wav","eb3.wav","eb4.wav","f3.wav","f4.wav","g3.wav","g4.wav","gb3.wav","gb4.wav"]),transLeads:name_to_path("/audio/epicTranceLead/",["a3.wav","a4.wav","ab3.wav","ab4.wav","b3.wav","b4.wav","bb3.wav","bb4.wav","c3.wav","c4.wav","c5.wav","d3.wav","d4.wav","db3.wav","db4.wav","e3.wav","e4.wav","eb3.wav","eb4.wav","f3.wav","f4.wav","g3.wav","g4.wav","gb3.wav","gb4.wav"]),perators:name_to_path("/audio/jarblePerator/",["a3.wav","a4.wav","ab3.wav","ab4.wav","b3.wav","b4.wav","bb3.wav","bb4.wav","c3.wav","c4.wav","d3.wav","d4.wav","db3.wav","db4.wav","e3.wav","e4.wav","eb3.wav","eb4.wav","f3.wav","f4.wav","g3.wav","g4.wav","gb3.wav","gb4.wav"]),korgBasses:name_to_path("/audio/korgBass/",["a1-33.wav","a2-45.wav","a3-57.wav","a4-69.wav","a5-81.wav","a6-93.wav","b1-35.wav","b2-47.wav","b3-59.wav","b4-71.wav","b5-83.wav","b6-95.wav","bb1-34.wav","bb2-46.wav","bb3-58.wav","bb4-70.wav","bb5-82.wav","bb6-94.wav","c1-24.wav","c2-36.wav","c3-48.wav","c4-60.wav","c5-72.wav","c6-84.wav","c7-96.wav","d1-26.wav","d2-38.wav","d3-50.wav","d4-62.wav","d5-74.wav","d6-86.wav","db1-25.wav","db2-37.wav","db3-49.wav","db4-61.wav","db5-73.wav","db6-85.wav","e-1-29.wav","e-2-41.wav","e-3-53.wav","e-4-65.wav","e-5-77.wav","e-6-89.wav","e1-28.wav","e2-40.wav","e3-52.wav","e4-64.wav","e5-76.wav","e6-88.wav","eb1-27.wav","eb2-39.wav","eb3-51.wav","eb4-63.wav","eb5-75.wav","eb6-87.wav","f1-30.wav","f2-42.wav","f3-54.wav","f4-66.wav","f5-78.wav","f6-90.wav","g1-32.wav","g2-44.wav","g3-56.wav","g4-68.wav","g5-80.wav","g6-92.wav","gb1-31.wav","gb2-43.wav","gb3-55.wav","gb4-67.wav","gb5-79.wav","gb6-91.wav"]),psyBasses:name_to_path("/audio/psyTranceBass/",["a1.wav","a2.wav","ab1.wav","ab2.wav","b1.wav","b2.wav","bb1.wav","bb2.wav","c1.wav","c2.wav","c3.wav","d1.wav","d2.wav","db1.wav","db2.wav","e1.wav","e2.wav","eb1.wav","eb2.wav","f1.wav","f2.wav","g1.wav","g2.wav","gb1.wav","gb2.wav"]),superSaws:name_to_path("/audio/superSaw/",["A4.wav","A5.wav","A6.wav","Ab3.wav","Ab4.wav","Ab5.wav","B4.wav","B5.wav","B6.wav","Bb4.wav","Bb5.wav","Bb6.wav","C3.wav","C4.wav","C5.wav","C6.wav","D3.wav","D4.wav","D5.wav","Db3.wav","Db4.wav","Db5.wav","E3.wav","E4.wav","E5.wav","Eb3.wav","Eb4.wav","Eb5.wav","F3.wav","F4.wav","F5.wav","G3.wav","G4.wav","G5.wav","Gb3.wav","Gb4.wav","Gb5.wav"])},happy={basses:name_to_path("/audio/basses/",["bass.wav"]),celestialPs:name_to_path("/audio/celestialPad/",["a4.wav","ab4.wav","b4.wav","bb4.wav","c4.wav","c5.wav","d4.wav","db4.wav","e4.wav","eb4.wav","f4.wav","g4.wav","gb4.wav"]),edmSounds:name_to_path("/audio/edm/",["drop.wav"]),guitars:name_to_path("/audio/guitars/",["mellow-2.wav"]),hats:name_to_path("/audio/hats/",["ch.wav","oh.wav"]),kicks:name_to_path("/audio/kicks/",["kick.wav"]),pianos:name_to_path("/audio/piano/",["piano72.wav","piano73.wav","piano74.wav","piano75.wav","piano76.wav","piano78.wav","piano79.wav","piano80.wav"]),snares:name_to_path("/audio/snares/",["snare.wav"]),superSaws:name_to_path("/audio/superSaw/",["A5.wav","A6.wav","Ab5.wav","B5.wav","B6.wav","Bb5.wav","Bb6.wav","C5.wav","C6.wav","D5.wav","Db5.wav","E5.wav","Eb5.wav","F5.wav","G5.wav","Gb5.wav"])},dark={basses:name_to_path("/audio/basses/",["bass.wav"]),guitars:name_to_path("/audio/guitars/",["mellow-1.wav","mellow-3.wav"]),kicks:name_to_path("/audio/kicks/",["kick.wav"]),pianos:name_to_path("/audio/piano/",["piano56.wav","piano57.wav","piano58.wav","piano59.wav","piano60.wav"]),snares:name_to_path("/audio/snares/",["snare.wav"])},synth={},guitar={B2:"/audio/guitars/mellow-2.wav",B3:"/audio/guitars/mellow-1.wav",F4:"/audio/guitars/mellow-3.wav"},guitar_notes=function(){var a=[];for(var e in guitar)a.push(e);return a}(),piano={C3:"/audio/piano/piano48.wav","C#3":"/audio/piano/piano49.wav",D3:"/audio/piano/piano50.wav","D#3":"/audio/piano/piano51.wav",E3:"/audio/piano/piano52.wav",F3:"/audio/piano/piano53.wav","F#3":"/audio/piano/piano54.wav",G3:"/audio/piano/piano55.wav","G#3":"/audio/piano/piano56.wav",A4:"/audio/piano/piano57.wav","A#4":"/audio/piano/piano58.wav",B4:"/audio/piano/piano59.wav",C4:"/audio/piano/piano60.wav"},piano_notes=function(){return pickRandom([["E3","C4","C3","G3","A4","F3","F3","C3","E3","C3","C3","G3","A3","F3","F3","C3","E3","C4","C3","G3","B3","G3","G3","D3","E3","C4","C3","G3","F#3","D3","D3","A4"]])}();$(function(){var a=$("#play"),e=$("#download"),n=!1,t=null;a.on("click",function(e){console.clear();var o=$("input[name='type']:checked").val();Tone.Transport.bpm.value="trap"==o?130:175,Tone.Transport.start(),n?(n=!1,stopPlaybackAndRecording(t),a.removeClass("btn-danger"),a.text("Create Beat")):(n=!0,a.text("Stop"),a.addClass("btn-danger"),t=createSong(o),playAndRecordSong(t))}),e.on("click",function(a){downloadBlob()}),a.on("zclick",function(a){Tone.Transport.bpm.value=175,Tone.Transport.start(),notesArr=piano_notes;var e=scribble.clip({samples:piano,notes:notesArr.join(" "),pattern:"xxxx".repeat(notesArr.length/2)});e.start()})});